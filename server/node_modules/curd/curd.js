#!/usr/bin/env node

const program = require('commander');
const config_path = `${process.cwd()}/curd.config.js`
const config = require(config_path);
const fs = require('fs');
const path = require('path');
program
  .command('create <name>')
  .description('create new vue file')
  .action((name)=>{
    createProgram(name);
  });

program
  .command('update <name>')
  .description('update exist vue file')
  .action((name)=>{
    updateProgram(name);
  });

program.parse(process.argv);


function createProgram(name){
  const src = path.resolve(config.src);
  const dist = path.resolve(config.output || './');
  checkConfig(src, dist);
  const newFile = `${dist}/${name}.vue`;
  fs.appendFileSync(newFile, "");
  fs.copyFileSync(src, `${dist}/${name}.vue`);
  updateProgram(name);
}

function updateProgram(name){
  const tpl_path = path.resolve(`${config.output}/${name}`);
  const template = require(tpl_path);
  if(config.table){
    modifyTable(config.table, template);
  }
  if(config.form){
    modifyForm(config.form, template);
  }
  if(config.dialog){
    modifyDialog(config.dialog, template);
  }
}
function modifyTable(config, template){
  if(config.props){
    console.log(template);
  }
}
function modifyForm(config, template){

}
function modifyDialog(config, template){

}


function exit(){
  process.exit(1);
}

function checkConfig(src, dist){
  if(!src){
    console.warn('请配置src目录');
    exit();
  }
  if(!fs.existsSync(path.resolve(src))){
    console.warn('您配置的src目录或文件不存在')
    exit();
  }
  if(!fs.existsSync(path.resolve(dist))){
    console.warn('您配置的output目录不存在')
    exit();
  }
}
